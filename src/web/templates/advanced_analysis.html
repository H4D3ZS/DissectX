{% extends "base.html" %}

{% block title %}Advanced Analysis - DissectX{% endblock %}

{% block content %}
<div class="container">
    <h1 class="page-title">Advanced Analysis</h1>

    <!-- Syscalls Section -->
    <div class="function-section">
        <h2 class="section-title">System Calls Detected</h2>
        {% if advanced.syscalls and advanced.syscalls|length > 0 %}
        <div class="code-container">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Syscall</th>
                        <th>Address</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    {% for syscall in advanced.syscalls %}
                    <tr>
                        {% if syscall is mapping %}
                        <td><code>{{ syscall.name or syscall.syscall or syscall }}</code></td>
                        <td><code>{{ syscall.address or 'N/A' }}</code></td>
                        <td>{{ syscall.description or syscall.desc or 'System call detected' }}</td>
                        {% else %}
                        <td><code>{{ syscall }}</code></td>
                        <td><code>N/A</code></td>
                        <td>System call detected</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No syscalls detected</p>
        {% endif %}
    </div>

    <!-- API Hashes Section -->
    <div class="function-section">
        <h2 class="section-title">Resolved API Hashes</h2>
        {% if advanced.api_hashes and advanced.api_hashes|length > 0 %}
        <div class="code-container">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Hash Value</th>
                        <th>Resolved API</th>
                        <th>Library</th>
                    </tr>
                </thead>
                <tbody>
                    {% for hash in advanced.api_hashes %}
                    <tr>
                        {% if hash is mapping %}
                        <td><code>{{ hash.hash or hash.value or hash }}</code></td>
                        <td><code>{{ hash.api_name or hash.api or 'Unknown' }}</code></td>
                        <td>{{ hash.library or hash.lib or 'N/A' }}</td>
                        {% else %}
                        <td><code>{{ hash }}</code></td>
                        <td><code>Unknown</code></td>
                        <td>N/A</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No API hashes detected</p>
        {% endif %}
    </div>

    <!-- Junk Code Section -->
    <div class="function-section">
        <h2 class="section-title">Junk Code Patterns</h2>
        {% if advanced.junk_patterns and advanced.junk_patterns|length > 0 %}
        <div class="code-container">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Pattern Type</th>
                        <th>Address</th>
                        <th>Confidence</th>
                    </tr>
                </thead>
                <tbody>
                    {% for pattern in advanced.junk_patterns %}
                    <tr>
                        {% if pattern is mapping %}
                        <td><code>{{ pattern.type or pattern.pattern or 'Junk Code' }}</code></td>
                        <td><code>{{ pattern.address or 'N/A' }}</code></td>
                        <td>{{ pattern.confidence or 'Medium' }}{% if pattern.confidence is number %}%{% endif %}</td>
                        {% else %}
                        <td><code>{{ pattern }}</code></td>
                        <td><code>N/A</code></td>
                        <td>Medium</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No junk code patterns detected</p>
        {% endif %}
    </div>

    <!-- Advanced Flags Section -->
    <div class="function-section">
        <h2 class="section-title">Advanced Flags</h2>
        {% if advanced.advanced_flags and advanced.advanced_flags|length > 0 %}
        <div class="code-container">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Flag</th>
                        <th>Type</th>
                        <th>Confidence</th>
                    </tr>
                </thead>
                <tbody>
                    {% for flag in advanced.advanced_flags %}
                    <tr>
                        {% if flag is mapping %}
                        <td><code>{{ flag.value or flag.flag or flag }}</code></td>
                        <td>{{ flag.type or flag.method or 'Detection' }}</td>
                        <td>{{ flag.confidence or 'High' }}</td>
                        {% else %}
                        <td><code>{{ flag }}</code></td>
                        <td>Detection</td>
                        <td>High</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No advanced flags found</p>
        {% endif %}
    </div>

    <!-- Decrypted Strings Section -->
    <div class="function-section">
        <h2 class="section-title">Decrypted Strings</h2>
        {% if advanced.decrypted_strings and advanced.decrypted_strings|length > 0 %}
        <div class="code-container">
            <table class="info-table">
                <thead>
                    <tr>
                        <th>Encrypted</th>
                        <th>Decrypted</th>
                        <th>Algorithm</th>
                    </tr>
                </thead>
                <tbody>
                    {% for string in advanced.decrypted_strings %}
                    <tr>
                        {% if string is mapping %}
                        <td><code>{{ string.encrypted or string.original or 'N/A' }}</code></td>
                        <td><code>{{ string.decrypted or string.decoded or string.value or string }}</code></td>
                        <td>{{ string.algorithm or string.method or 'Unknown' }}</td>
                        {% else %}
                        <td><code>N/A</code></td>
                        <td><code>{{ string }}</code></td>
                        <td>Unknown</td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="no-data">No encrypted strings detected</p>
        {% endif %}
    </div>
</div>
{% endblock %}
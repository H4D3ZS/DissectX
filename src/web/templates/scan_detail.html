{% extends "base.html" %}

{% block title %}Scan Details - {{ scan.filename }} - DissectX{% endblock %}

{% block content %}
<div class="scan-detail-page">
    <div class="breadcrumb">
        <a href="/">Dashboard</a> / 
        <a href="/recent-scans">Recent Scans</a> / 
        <span>{{ scan.filename }}</span>
    </div>

    <h1>üìÑ {{ scan.filename }}</h1>
    
    <div class="scan-meta">
        <div class="meta-item">
            <span class="meta-label">Scan Date:</span>
            <span class="meta-value">{{ scan.timestamp[:19].replace('T', ' ') }}</span>
        </div>
        <div class="meta-item">
            <span class="meta-label">Scan ID:</span>
            <span class="meta-value"><code>{{ scan.id }}</code></span>
        </div>
    </div>

    <!-- Hash Verification Section -->
    <div class="section">
        <h2>üîê Hash Verification</h2>
        <p>Use these hashes to verify the integrity of the analyzed binary</p>
        
        <div class="hash-table">
            <div class="hash-row">
                <div class="hash-type">MD5</div>
                <div class="hash-value-container">
                    <code class="hash-value">{{ scan.hashes.md5 }}</code>
                    <button class="copy-btn" data-hash="{{ scan.hashes.md5 }}">üìã</button>
                </div>
            </div>
            <div class="hash-row">
                <div class="hash-type">SHA1</div>
                <div class="hash-value-container">
                    <code class="hash-value">{{ scan.hashes.sha1 }}</code>
                    <button class="copy-btn" data-hash="{{ scan.hashes.sha1 }}">üìã</button>
                </div>
            </div>
            <div class="hash-row">
                <div class="hash-type">SHA256</div>
                <div class="hash-value-container">
                    <code class="hash-value">{{ scan.hashes.sha256 }}</code>
                    <button class="copy-btn" data-hash="{{ scan.hashes.sha256 }}">üìã</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Binary Information -->
    {% if results.binary_info %}
    <div class="section">
        <h2>üìä Binary Information</h2>
        <table class="info-table">
            {% for key, value in results.binary_info.items() %}
            {% if key != 'hashes' %}
            <tr>
                <th>{{ key }}</th>
                <td>{{ value }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </table>
    </div>
    {% endif %}

    <!-- Quick Stats -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon">üìù</div>
            <div class="stat-value">{{ results.strings|length }}</div>
            <div class="stat-label">Strings Found</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-value">{{ results.security_strings|length }}</div>
            <div class="stat-label">Security Strings</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üîç</div>
            <div class="stat-value">{{ scan.summary.total_functions }}</div>
            <div class="stat-label">Functions</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">üö©</div>
            <div class="stat-value">{{ scan.summary.security_flags }}</div>
            <div class="stat-label">Security Flags</div>
        </div>
    </div>

    <!-- Strings Preview -->
    {% if results.strings %}
    <div class="section">
        <h2>üìù Strings (Preview)</h2>
        <div class="strings-container">
            {% for string in results.strings[:50] %}
            <div class="string-item">
                <code>{{ string.value }}</code>
            </div>
            {% endfor %}
            {% if results.strings|length > 50 %}
            <div class="more-indicator">
                ... and {{ results.strings|length - 50 }} more strings
            </div>
            {% endif %}
        </div>
    </div>
    {% endif %}

    <!-- Security Strings -->
    {% if results.security_strings %}
    <div class="section">
        <h2>‚ö†Ô∏è Security-Related Strings</h2>
        <div class="security-strings-container">
            {% for string in results.security_strings %}
            <div class="security-string-item">
                <code>{{ string.value }}</code>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="actions-section">
        <a href="/recent-scans" class="btn btn-secondary">‚Üê Back to Recent Scans</a>
        <a href="/" class="btn btn-primary">View Full Analysis</a>
    </div>
</div>

<style>
    .scan-detail-page {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .breadcrumb {
        color: #858585;
        margin-bottom: 20px;
        font-size: 0.9em;
    }

    .breadcrumb a {
        color: #569cd6;
        text-decoration: none;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    .scan-meta {
        display: flex;
        gap: 30px;
        margin: 20px 0;
        padding: 15px;
        background: #252526;
        border-radius: 8px;
    }

    .meta-item {
        display: flex;
        gap: 10px;
    }

    .meta-label {
        color: #858585;
        font-weight: 600;
    }

    .meta-value {
        color: #d4d4d4;
    }

    .section {
        background: #1e1e1e;
        border: 1px solid #3c3c3c;
        border-radius: 8px;
        padding: 25px;
        margin: 20px 0;
    }

    .section h2 {
        margin-top: 0;
        color: #d4d4d4;
        border-bottom: 2px solid #007acc;
        padding-bottom: 10px;
        margin-bottom: 20px;
    }

    .hash-table {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .hash-row {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background: #252526;
        border-radius: 6px;
    }

    .hash-type {
        color: #569cd6;
        font-weight: 600;
        min-width: 80px;
        font-size: 1.1em;
    }

    .hash-value-container {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
    }

    .hash-value {
        color: #ce9178;
        font-family: 'Courier New', monospace;
        font-size: 0.9em;
        word-break: break-all;
        flex: 1;
        background: #1e1e1e;
        padding: 8px 12px;
        border-radius: 4px;
    }

    .copy-btn {
        background: #007acc;
        border: none;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .copy-btn:hover {
        background: #005a9e;
    }

    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
    }

    .stat-card {
        background: #1e1e1e;
        border: 1px solid #3c3c3c;
        border-radius: 8px;
        padding: 20px;
        text-align: center;
        transition: transform 0.2s;
    }

    .stat-card:hover {
        transform: translateY(-2px);
        border-color: #007acc;
    }

    .stat-icon {
        font-size: 2.5em;
        margin-bottom: 10px;
    }

    .stat-value {
        font-size: 2em;
        font-weight: bold;
        color: #007acc;
        margin-bottom: 5px;
    }

    .stat-label {
        color: #858585;
        font-size: 0.9em;
    }

    .info-table {
        width: 100%;
        border-collapse: collapse;
    }

    .info-table th,
    .info-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #3c3c3c;
    }

    .info-table th {
        color: #569cd6;
        font-weight: 600;
        width: 200px;
    }

    .info-table td {
        color: #d4d4d4;
    }

    .strings-container,
    .security-strings-container {
        max-height: 400px;
        overflow-y: auto;
    }

    .string-item,
    .security-string-item {
        padding: 8px 12px;
        margin: 5px 0;
        background: #252526;
        border-radius: 4px;
        border-left: 3px solid #007acc;
    }

    .security-string-item {
        border-left-color: #f48771;
    }

    .string-item code,
    .security-string-item code {
        color: #ce9178;
        font-size: 0.9em;
    }

    .more-indicator {
        text-align: center;
        padding: 15px;
        color: #858585;
        font-style: italic;
    }

    .actions-section {
        display: flex;
        gap: 15px;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #3c3c3c;
    }

    @media (max-width: 768px) {
        .scan-meta {
            flex-direction: column;
            gap: 10px;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .hash-row {
            flex-direction: column;
            align-items: flex-start;
        }

        .hash-value-container {
            width: 100%;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy hash to clipboard
        document.querySelectorAll('.copy-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const hash = this.getAttribute('data-hash');
                navigator.clipboard.writeText(hash).then(() => {
                    const originalText = this.textContent;
                    this.textContent = '‚úì';
                    this.style.background = '#28a745';
                    
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.style.background = '';
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy hash');
                });
            });
        });
    });
</script>
{% endblock %}

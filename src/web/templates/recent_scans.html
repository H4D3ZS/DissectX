{% extends "base.html" %}

{% block title %}Recent Scans - DissectX{% endblock %}

{% block content %}
<div class="recent-scans-page">
    <h1>ðŸ“‹ Recent Scans</h1>
    <p>Browse your recently analyzed binaries with verification hashes</p>

    {% if scans %}
    <div class="scans-grid">
        {% for scan in scans %}
        <div class="scan-card">
            <div class="scan-header">
                <h3>{{ scan.filename }}</h3>
                <span class="scan-date">{{ scan.timestamp[:19].replace('T', ' ') }}</span>
            </div>
            
            <div class="scan-hashes">
                <div class="hash-item">
                    <span class="hash-label">MD5:</span>
                    <code class="hash-value">{{ scan.hashes.md5 }}</code>
                </div>
                <div class="hash-item">
                    <span class="hash-label">SHA1:</span>
                    <code class="hash-value">{{ scan.hashes.sha1 }}</code>
                </div>
                <div class="hash-item">
                    <span class="hash-label">SHA256:</span>
                    <code class="hash-value">{{ scan.hashes.sha256 }}</code>
                </div>
            </div>
            
            <div class="scan-summary">
                <div class="summary-item">
                    <span class="summary-label">File Type:</span>
                    <span class="summary-value">{{ scan.summary.file_type }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Strings:</span>
                    <span class="summary-value">{{ scan.summary.total_strings }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Functions:</span>
                    <span class="summary-value">{{ scan.summary.total_functions }}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Security Flags:</span>
                    <span class="summary-value">{{ scan.summary.security_flags }}</span>
                </div>
            </div>
            
            <div class="scan-actions">
                <a href="/scan/{{ scan.id }}" class="btn btn-primary">View Details</a>
                <button class="btn btn-secondary copy-hash-btn" data-hash="{{ scan.hashes.sha256 }}">
                    ðŸ“‹ Copy SHA256
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="empty-state">
        <div class="empty-icon">ðŸ“‚</div>
        <h2>No Recent Scans</h2>
        <p>Upload a binary to start analyzing</p>
        <a href="/" class="btn btn-primary">Upload Binary</a>
    </div>
    {% endif %}
</div>

<style>
    .recent-scans-page {
        padding: 20px;
    }

    .scans-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(500px, 1fr));
        gap: 20px;
        margin-top: 30px;
    }

    .scan-card {
        background: #1e1e1e;
        border: 1px solid #3c3c3c;
        border-radius: 8px;
        padding: 20px;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .scan-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.2);
    }

    .scan-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px solid #3c3c3c;
    }

    .scan-header h3 {
        margin: 0;
        color: #d4d4d4;
        font-size: 1.1em;
        word-break: break-all;
    }

    .scan-date {
        color: #858585;
        font-size: 0.85em;
        white-space: nowrap;
    }

    .scan-hashes {
        margin: 15px 0;
        background: #252526;
        padding: 15px;
        border-radius: 6px;
    }

    .hash-item {
        display: flex;
        align-items: center;
        margin: 8px 0;
    }

    .hash-label {
        color: #569cd6;
        font-weight: 600;
        min-width: 70px;
        font-size: 0.9em;
    }

    .hash-value {
        color: #ce9178;
        font-family: 'Courier New', monospace;
        font-size: 0.85em;
        word-break: break-all;
        background: #1e1e1e;
        padding: 4px 8px;
        border-radius: 4px;
        flex: 1;
    }

    .scan-summary {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin: 15px 0;
    }

    .summary-item {
        display: flex;
        flex-direction: column;
        padding: 10px;
        background: #252526;
        border-radius: 6px;
    }

    .summary-label {
        color: #858585;
        font-size: 0.85em;
        margin-bottom: 5px;
    }

    .summary-value {
        color: #d4d4d4;
        font-weight: 600;
        font-size: 1.1em;
    }

    .scan-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
    }

    .scan-actions .btn {
        flex: 1;
    }

    .copy-hash-btn {
        cursor: pointer;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #858585;
    }

    .empty-icon {
        font-size: 4em;
        margin-bottom: 20px;
    }

    .empty-state h2 {
        color: #d4d4d4;
        margin-bottom: 10px;
    }

    .empty-state p {
        margin-bottom: 20px;
    }

    @media (max-width: 768px) {
        .scans-grid {
            grid-template-columns: 1fr;
        }
        
        .scan-summary {
            grid-template-columns: 1fr;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Copy hash to clipboard
        document.querySelectorAll('.copy-hash-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const hash = this.getAttribute('data-hash');
                navigator.clipboard.writeText(hash).then(() => {
                    const originalText = this.textContent;
                    this.textContent = 'âœ“ Copied!';
                    this.style.background = '#28a745';
                    
                    setTimeout(() => {
                        this.textContent = originalText;
                        this.style.background = '';
                    }, 2000);
                }).catch(err => {
                    alert('Failed to copy hash');
                });
            });
        });
    });
</script>
{% endblock %}
